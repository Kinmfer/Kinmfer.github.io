<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>综合架构-文件共享服务+传输服务 | Kinmfer's Blogs</title><meta name="keywords" content="数据同步,NFS,Rsync,FTP,Samba"><meta name="author" content="Kinmfer,kinmfer@foxmail.com"><meta name="copyright" content="Kinmfer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="FTP服务ftp协议文件传输协议  协议定义了一个远程计算机系统和本地计算机系统之间传输文件的一个标准 FTP运载OSI七层模型的应用层，并利用传输协议TCP在不同主机之间提供可靠的数据传输 FTP在文件传输中还支持断点续传功能，可以大幅的减少CPU网络带宽的开销  ftp模型 用户接口: 提供了一个用户接口并使用用户端协议解释器的服务 客户端协议解释器：向远程主机发送命令，并建立客户端数据传输过">
<meta property="og:type" content="article">
<meta property="og:title" content="综合架构-文件共享服务+传输服务">
<meta property="og:url" content="https://kinmfer.github.io/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB+%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="Kinmfer&#39;s Blogs">
<meta property="og:description" content="FTP服务ftp协议文件传输协议  协议定义了一个远程计算机系统和本地计算机系统之间传输文件的一个标准 FTP运载OSI七层模型的应用层，并利用传输协议TCP在不同主机之间提供可靠的数据传输 FTP在文件传输中还支持断点续传功能，可以大幅的减少CPU网络带宽的开销  ftp模型 用户接口: 提供了一个用户接口并使用用户端协议解释器的服务 客户端协议解释器：向远程主机发送命令，并建立客户端数据传输过">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/Kinmfer/BlogImages/raw/master/img/QQ截图20200509215804.png">
<meta property="article:published_time" content="2020-05-05T01:49:41.000Z">
<meta property="article:modified_time" content="2020-12-06T08:32:09.213Z">
<meta property="article:author" content="Kinmfer">
<meta property="article:tag" content="数据同步">
<meta property="article:tag" content="NFS">
<meta property="article:tag" content="Rsync">
<meta property="article:tag" content="FTP">
<meta property="article:tag" content="Samba">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/Kinmfer/BlogImages/raw/master/img/QQ截图20200509215804.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://kinmfer.github.io/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB+%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c46ed77365f502de73543fbf10399875";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"C2N62A47W9","apiKey":"0c62f17095ec2a20c19657511a42c0b1","indexName":"Blogs","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"这篇文章更新于","messageNext":"天前,内容可能已经过时"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: Kinmfer","link":"链接: ","source":"来源: Kinmfer's Blogs","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-06 16:32:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = '1  Following System Settings, if the system doesn't support dark mode, it will switch dark mode between 6 pm to 6 am'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/Kinmfer/BlogImages/raw/master/img/QQ截图20200509215804.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kinmfer's Blogs</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">综合架构-文件共享服务+传输服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-05T01:49:41.000Z" title="发表于 2020-05-05 09:49:41">2020-05-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-06T08:32:09.213Z" title="更新于 2020-12-06 16:32:09">2020-12-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB+%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB+%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="FTP服务"><a href="#FTP服务" class="headerlink" title="FTP服务"></a>FTP服务</h1><h2 id="ftp协议"><a href="#ftp协议" class="headerlink" title="ftp协议"></a>ftp协议</h2><p>文件传输协议</p>
<ul>
<li>协议定义了一个远程计算机系统和本地计算机系统之间传输文件的一个标准</li>
<li>FTP运载OSI七层模型的应用层，并利用传输协议TCP在不同主机之间提供可靠的数据传输</li>
<li>FTP在文件传输中还支持断点续传功能，可以大幅的减少CPU网络带宽的开销</li>
</ul>
<h2 id="ftp模型"><a href="#ftp模型" class="headerlink" title="ftp模型"></a>ftp模型</h2><ul>
<li>用户接口: 提供了一个用户接口并使用用户端协议解释器的服务</li>
<li>客户端协议解释器：向远程主机发送命令，并建立客户端数据传输过程</li>
<li>服务端协议解释器：响应客户端协议发出的命令并驱动服务器的数据传输</li>
<li>客户端数据传输协议：负责完成和服务端数据传输过程及客户端本地文件系统的通信</li>
<li>服务端数据传输协议：负责完成和客户端数据传输过程及服务端本地文件系统的通信</li>
<li>连接方式：不同的连接方式需要合适的服务质量<ul>
<li>命令连接： 建立连接及命令发送和响应（需要更小的延迟时间） 21端口</li>
<li>数据连接： 用于数据传输（需要更大的数据吞吐量） 20端口</li>
</ul>
</li>
</ul>
<h2 id="控制连接"><a href="#控制连接" class="headerlink" title="控制连接"></a>控制连接</h2><ul>
<li>主要用来传输实际通信中需要执行的FTP命令以及命令响应</li>
<li>只需要很小的网络带宽</li>
<li>FTP服务器监听在21端口来等待控制连接建立</li>
<li>建立控制连接之后，还需要验证客户端身份，决定是否建立数据连接</li>
<li>当需要目录列表，传输文件时，才建立数据连接，并且每次客户端都会使用不同的随机端口来建立数据连接；当数据传输完毕之后，就断开数据连接</li>
<li>在FTP连接期间，控制连接始终保持连接状态，在数据连接存在的期间，控制连接必须存在，一旦控制连接断开，数据连接会自动断开</li>
</ul>
<h2 id="数据连接"><a href="#数据连接" class="headerlink" title="数据连接"></a>数据连接</h2><ul>
<li>FTP服务端监听在20端口上等待数据连接</li>
<li>数据连接依赖于控制连接</li>
</ul>
<h3 id="主动模式"><a href="#主动模式" class="headerlink" title="主动模式"></a>主动模式</h3><ol>
<li>三次握手建立命令连接，客户端的端口是随机的，目标端口是21 </li>
<li>控制连接建立完成之后，客户端进行验证，协商数据连接采用的模式（主动模式）<br>随后客户端会向FTP服务端发送Port报文(端口为命令连接使用的端口向后的第一个可用端口)，表明自己的IP地址及端口号信息；等待FTP服务端20端口主动地发起数据连接请求</li>
<li>服务端发送数据连接请求，连接建立之后开始进行数据传输</li>
</ol>
<h3 id="被动模式"><a href="#被动模式" class="headerlink" title="被动模式"></a>被动模式</h3><ol>
<li>三次握手建立控制连接，客户端的端口是随机的，目标端口是21 </li>
<li>控制连接建立完成之后，客户端进行验证，协商数据连接采用的模式（被动模式）<br>客户端向服务端发送PASV报文，表示我们用被动模式</li>
<li>服务端在收到PASV报文，向客户端发送Port报文，表明自己的IP地址及端口号信息；</li>
<li>客户端发送数据连接请求，建立数据连接 </li>
</ol>
<ul>
<li>关键点： 主动和被动在于服务端是主动建立数据连接还是被动建立数据连接</li>
</ul>
<h1 id="Vsftpd服务"><a href="#Vsftpd服务" class="headerlink" title="Vsftpd服务"></a>Vsftpd服务</h1><ul>
<li>是一个安全，高速，稳定的FTP服务器</li>
<li>可设定多个基于IP的虚拟FTP服务器</li>
<li>匿名FTP服务器更是十分容易的</li>
<li>不执行任何外部程序，从而减少了安全隐患</li>
<li>支持虚拟用户，且支持每个虚拟用户具有独立的配置</li>
<li>支持带宽限制等等</li>
<li><strong>注意：</strong>一个用户通过文件共享服务访问文件系统上的文件的生效权限为此两者的交集</li>
</ul>
<h2 id="FTP服务的使用者"><a href="#FTP服务的使用者" class="headerlink" title="FTP服务的使用者"></a>FTP服务的使用者</h2><ul>
<li>vsftpd以ftp用户的身份运行进程，默认用户即为ftp用户，匿名用户的默认路径即ftp用户的家目录/var/ftp</li>
<li>匿名用户<ul>
<li>anonymous用户并没有设置密码进行登录ftp服务端</li>
<li>一般情况下匿名用户只能够拥有下载查看功能</li>
</ul>
</li>
<li>本地用户<ul>
<li>既可以登录shell也可以登录ftp服务端</li>
<li>本地用户登录系统后，其登录目录为本地家目录</li>
<li>一般情况下拥有上传和下载功能</li>
</ul>
</li>
<li>虚拟用户<ul>
<li>如果用户在远程FTP服务端上拥有账号，但是不能登录shell</li>
<li>虚拟用户登录系统后，其登录为指定目录</li>
<li>一般情况下拥有上传和下载功能</li>
</ul>
</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>[root@test ~]# dnf install vsftpd -y</code></p>
<ul>
<li><p>服务包：vsftpd </p>
</li>
<li><p>服务类型： 是由systemd启动的守护进程</p>
</li>
<li><p>配置单元：/usr/lib/systemd/system/vsftpd.service</p>
</li>
<li><p>守护进程： /usr/sbin/vsftpd </p>
</li>
<li><p>端口： 21（controller） 20 (data)</p>
</li>
<li><p>主配置文件： /etc/vsftpd/vsftpd.conf</p>
</li>
<li><p>用户访问控制配置文件：</p>
<ul>
<li><p>/etc/vsftpd/ftpusers</p>
</li>
<li><p>/etc/vsftpd/user_list</p>
</li>
</ul>
</li>
<li><p>日志文件：/etc/logrotate.d/vsftpd</p>
</li>
<li><p>URL：</p>
<ul>
<li><p>SCHEME://username:password@HOST:PORT/PATH/TO/FILE</p>
</li>
<li><p>路径映射：</p>
<ul>
<li>用户家目录：每个用户的URL的/映射到当前用户的家目录</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>主配置文件：<br>默认配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># cat /etc/vsftpd/vsftpd.conf | grep -Ev &quot;^$|^#&quot;</span></span><br><span class="line">anonymous_enable=YES	<span class="comment"># 匿名用户是否开启</span></span><br><span class="line">local_enable=YES	<span class="comment"># 是否允许本地用户可以登录</span></span><br><span class="line">write_enable=YES	<span class="comment"># 是否对登录用户可写</span></span><br><span class="line">local_umask=022		<span class="comment"># 本地用户上传文件默认权限的umask值</span></span><br><span class="line">dirmessage_enable=YES	<span class="comment"># 是否激活目录欢迎信息功能</span></span><br><span class="line">xferlog_enable=YES		<span class="comment"># 是否让系统自动维护上传和下载的日志工作</span></span><br><span class="line">connect_from_port_20=YES	<span class="comment"># 是否设置FTP服务器端将启用FTP数据端口的连接请求</span></span><br><span class="line">xferlog_std_format=YES	<span class="comment"># 以xferlog日志格式写入到日志文件中</span></span><br><span class="line">listen=NO		<span class="comment"># 是否监听</span></span><br><span class="line">listen_ipv6=YES	<span class="comment"># 是否支持IPv6</span></span><br><span class="line">pam_service_name=vsftpd	<span class="comment"># PAM模式提供的认证服务</span></span><br><span class="line">userlist_enable=YES	<span class="comment"># 是否允许ftpusers文件中的用户登录ftp服务器</span></span><br><span class="line">tcp_wrappers=YES	<span class="comment"># 是否使用tcp_wrappers作为主机访问控制访问</span></span><br></pre></td></tr></table></figure>
<h2 id="实例1：匿名用户"><a href="#实例1：匿名用户" class="headerlink" title="实例1：匿名用户"></a>实例1：匿名用户</h2><ol>
<li><p>关闭防火墙和SELINUX</p>
</li>
<li><p>配置参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匿名用户相关配置参数：</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line">anon_umask=022 </span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line">anon_root = /path/to/file <span class="comment"># 指定匿名用户登录系统后的目录所在位置 ；默认情况下是：/var/ftp/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改指定目录的属主<br><code>[root@test pub]# chown -Rf ftp /var/ftp/pub/</code></p>
</li>
<li><p>使用anonymous用户登录测试<br><a href="ftp://x.x.x.x/">ftp://x.x.x.x</a>  用户名： anonymous 密码： </p>
</li>
</ol>
<h2 id="实例2-本地用户"><a href="#实例2-本地用户" class="headerlink" title="实例2: 本地用户"></a>实例2: 本地用户</h2><ol>
<li><p>关闭防火墙和SELINUX</p>
</li>
<li><p>配置参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地用户相关配置参数：</span></span><br><span class="line">local_enable=YES</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="comment"># 控制可登录vsftpd服务的用户列表</span></span><br><span class="line">userlist_enable=YES</span><br><span class="line"><span class="comment"># YES意味着此为黑名单，NO意味着此为白名单</span></span><br><span class="line">userlist_deny=YES|NO</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁锢所有本地用户与家目录；需要事先去除用户对家目录的写权限 </span></span><br><span class="line">chroot_local_user=YES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁锢列表中文件存在的用户于其家目录中；需要事先去除用户对家目录的写权限 </span></span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vstpd/chroot_list</span><br></pre></td></tr></table></figure></li>
<li><p>检查/etc/pam.d/vsftpd文件中 </p>
<p>列在此文件中的所有用户，均被禁止使用ftp服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth  required	pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed	<span class="comment"># 参数必须要有</span></span><br></pre></td></tr></table></figure></li>
<li><p>检查user_list和ftpuser文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># cat /etc/vsftpd/ftpusers </span></span><br><span class="line"><span class="comment"># Users that are not allowed to login via ftp	# “黑名单”</span></span><br><span class="line"><span class="comment"># root</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># cat /etc/vsftpd/user_list</span></span><br><span class="line"><span class="comment"># If userlist_deny=YES (default), never allow users in this file, and	# 默认情况是“黑名单”</span></span><br><span class="line"><span class="comment"># root</span></span><br></pre></td></tr></table></figure></li>
<li><p>重启vsftpd服务并使用本地用户root进行登录测试</p>
</li>
</ol>
<h2 id="实例3：虚拟用户"><a href="#实例3：虚拟用户" class="headerlink" title="实例3：虚拟用户"></a>实例3：虚拟用户</h2><ol>
<li><p>关闭防火墙和SELINUX</p>
</li>
<li><p>创建用于FTP认证的用户数据文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/vsftpd/vconf  </span><br><span class="line">cat &gt; /etc/vsftpd/vconf/vftpuser.txt &lt;&lt;<span class="string">EOF  </span></span><br><span class="line"><span class="string">xiaohong  	# 用户名1</span></span><br><span class="line"><span class="string">xiaohong  	# 密码 </span></span><br><span class="line"><span class="string">xiaoming  	# 用户名2 </span></span><br><span class="line"><span class="string">xiaoming  	# 密码 </span></span><br><span class="line"><span class="string">EOF</span>  </span><br></pre></td></tr></table></figure></li>
<li><p>将明文信息转成数据文件<br><code>db_load ‐T ‐t hash ‐f /etc/vsftpd/vconf/vftpuser.txt /etc/vsftpd/vconf/vftpuser.db </code></p>
</li>
<li><p>创建vsftpd服务应用程序用于存储文件的根目录已经虚拟用户映射的系统本地用户<br><code>useradd -d /var/ftproot -s /sbin/nologin virtual</code><br><code>chmod -Rf 755 /var/ftproot/</code></p>
</li>
<li><p>建立用户支持虚拟用户的PAM文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. [root@<span class="built_in">test</span> pam.d]<span class="comment"># cat /etc/pam.d/vsftpd</span></span><br><span class="line">auth	   required     pam_userdb.so db=/etc/vsftpd/vconf/vftpuser</span><br><span class="line">account	   required     pam_userdb.so db=/etc/vsftpd/vconf/vftpuser</span><br></pre></td></tr></table></figure></li>
<li><p>配置参数:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 虚拟用户相关配置参数：</span></span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=virtual </span><br><span class="line">allow_writeable_chroot=YES </span><br><span class="line">user_config_dir=/etc/vsftpd/vconf/</span><br></pre></td></tr></table></figure></li>
<li><p>为不同虚拟用户设置不同的权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> vconf]<span class="comment"># cat /etc/vsftpd/vconf/zhangsan </span></span><br><span class="line">local_root=/var/ftproot/  </span><br><span class="line">write_enable=YES  </span><br><span class="line">anon_upload_enable=YES  </span><br><span class="line">anon_mkdir_write_enable=YES  </span><br><span class="line">anon_other_write_enable=YES</span><br></pre></td></tr></table></figure></li>
<li><p>重启vsftpd服务并登陆测试</p>
</li>
</ol>
<h1 id="lftp命令详解"><a href="#lftp命令详解" class="headerlink" title="lftp命令详解"></a>lftp命令详解</h1><h2 id="登录ftp"><a href="#登录ftp" class="headerlink" title="登录ftp"></a>登录ftp</h2><p>代码:<br><code>lftp 用户名:密码@ftp地址:传送端口（默认21）</code><br>用法<br>(1)<code>lftp username:password@127.0.0.1:21</code><br>(2)<code>lftp username@127.0.0.1</code> 回车   ##默认21端口 回车后输入密码<br>(3)<code>lftp 127.0.0.1</code> 回车  ##回车后 login 登录<br>(4)<code>lftp</code> 回车 –&gt; open 127.0.0.1 –&gt; login 登录</p>
<h2 id="lftp中文乱码问题"><a href="#lftp中文乱码问题" class="headerlink" title="lftp中文乱码问题"></a>lftp中文乱码问题</h2><p>登录后看到的都是中文乱码(因为一般本地都是utf-8的编码)，用 set 命令来解决</p>
<p><code>set ftp:charset gbk(或者 gb2312 或 utf-8) </code>##设置ftp端的编码格式<br><code>set file:charset utf-8 (...同上)</code> ##设置本地编码格式</p>
<p>附:set命令的技巧 (1)输入set 查看已经设置好的命令 (2)set -a 查看所有可以设置的命令清晰网</p>
<h2 id="查找ftp端文件"><a href="#查找ftp端文件" class="headerlink" title="查找ftp端文件"></a>查找ftp端文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls *.txt <span class="comment">##查找当前目录下的所有txt文件</span></span><br><span class="line">ls ./123/ <span class="comment">##列出123目录下所有文件</span></span><br><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span>  <span class="comment">##递归查找站点上所有的txt文件</span></span><br><span class="line">find ./xx -name <span class="string">&quot;*.txt&quot;</span> <span class="comment">##查找xx目录下所有的txt文件</span></span><br></pre></td></tr></table></figure>
<p>附1: ls第二次读取的是本地缓存,可以用 rels 代替 ls 或者catch off / catch on 来开关catch,catch flush清空本地catch<br>附2: 浏览本地目录的命令可用 !ls , 如 !ls /usr/local/bin/</p>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>下载文件之前要先设置好本地的目录，用来存放下载的文件<br>lcd /home/123/web  ##设置本地存放目录 默认为 /home/usr</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">get 123.txt   <span class="comment">##下载123.txt文件到 /home/123/web 中</span></span><br><span class="line">get -c 123.txt <span class="comment">##断点续传下载</span></span><br><span class="line">mget *.txt   <span class="comment">##批量下载所有txt文件</span></span><br><span class="line">mget -c *.txt <span class="comment">##断点续传</span></span><br><span class="line">mget -c ./123/aaa/*.txt  <span class="comment">##断点续传、批量[下载](http://apps.hi.baidu.com/w_empty/blog/item/:void(0);/.1212516110553*/)ftp端aaa目录下的所有txt文件</span></span><br><span class="line"></span><br><span class="line">pget -c -n 10 file.dat</span><br><span class="line">\<span class="comment">##以最多10个线程以允许断点续传的方式下载file.dat</span></span><br><span class="line">\<span class="comment">##可以通过设置 set pget:default-n 5 的值而使用默认值。</span></span><br><span class="line"></span><br><span class="line">mirror aaa/</span><br><span class="line">\<span class="comment">##将aaa目录整个的下载下来，子目录也会自动复制 本地自动建立目录</span></span><br></pre></td></tr></table></figure>
<h2 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">put 123.txt   <span class="comment">##同下载</span></span><br><span class="line">mput *.txt   <span class="comment">##同下载</span></span><br><span class="line">mirror -R aaa/ <span class="comment">##同下载</span></span><br></pre></td></tr></table></figure>
<h2 id="设置被动-非被动模式"><a href="#设置被动-非被动模式" class="headerlink" title="设置被动/非被动模式"></a>设置被动/非被动模式</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> ftp:passive-mode 1 <span class="comment">## 1 被动 0非主动</span></span><br></pre></td></tr></table></figure>
<h2 id="多任务处理"><a href="#多任务处理" class="headerlink" title="多任务处理"></a>多任务处理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ctrl+z <span class="comment">##将当前进行的任务移交后台处理</span></span><br><span class="line"><span class="built_in">wait</span>  <span class="comment">##将后台处理任[务调](http://apps.hi.baidu.com/w_empty/blog/item/:void(0);/.1212516124164*/)至前台查看</span></span><br><span class="line"><span class="built_in">jobs</span>  <span class="comment">##查看后台进行的任务列表</span></span><br><span class="line"><span class="built_in">kill</span> all 或者 job_no <span class="comment">##删除所有任务 或 指定的任务</span></span><br><span class="line"></span><br><span class="line">\<span class="comment">##将任务加入任务列表</span></span><br><span class="line">queue get 123.txt</span><br><span class="line">queue put 234.txt</span><br><span class="line">queue mirror aaa/ </span><br><span class="line"></span><br><span class="line">queue <span class="comment">##查看任务列表</span></span><br><span class="line"><span class="built_in">jobs</span>  <span class="comment">##查看后台任务列表</span></span><br><span class="line"></span><br><span class="line">queue start <span class="comment">##开始任务列表</span></span><br><span class="line">queue stop <span class="comment">##停止任务列表</span></span><br></pre></td></tr></table></figure>
<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><p>定义别名</p>
<p>alias less more<br>alias reconnect “close; cd .”<br>直接输入 alias 即可看到目前定义了<a target="_blank" rel="noopener" href="http://apps.hi.baidu.com/w_empty/blog/item/:void(0);/.1212516138250*/">那些别名</a>。如果只输入 alias name 的话, 则是取消 name 这个别名。</p>
<p>bookmark SUBCMD<br>设定书签, 可将目前站台及所在目录设成书签, 下次可直接进来, 不用再 cd 来 cd 去的</p>
<p>bookmark add name 用来新增名称为 name 的书签<br>bookmark del name 删除名称为 name 的书签<br>bookmark list 显示目前有设定那些书签(另外直接打 bookmark 和 bookmark list 的结果一样)<br>bookmark edit 呼叫编辑器修改书签 (~/.lftp/bookmarks)</p>
<p>cd 切换远端目录</p>
<p>cache SUBCMD<br>管理 lftp 的 cache</p>
<p>rels []<br>从 cache 中显示远端档案列表<br>rels 则不会从 cache 中读取</p>
<p>recls opts [path/]pattern<br>从 cache 中显示远端的档案列表, 应该算是 ls 的加强版, 有很多参数可用,应该是可用来产生各种不同&gt;的档案列表以供其他程式使用。<br>recls 则不会从 cache 中读取</p>
<p>du options<br>计算远端整个目录占用容量</p>
<p>get OPTS -o<br>抓取远端档案 清晰网 </p>
<p>get rfile -o lfile<br>抓 rfile 到本地改名为 lfile<br>-c 为续传<br>-E 抓档完成后, 将远端的档案砍了<br>-a 为 ascii mode, 预设为 binary mode<br>-O 设定 base directory 为本地端放档案的目录</p>
<p>mget OPTS<br>下载远端档案(可用 wildcard expansion 也就是 *)</p>
<p>pget OPTS -o<br>使用多个连结来下载档案, 预设为五个。<br>-n 3 为叁个连结</p>
<p>jobs -v<br>显示目前有那些程序在背景执行<br>-v 显示详细的资讯(-v 可多加几个来显示更详细的资讯)</p>
<p>lcd<br>切换本地端的目录</p>
<p>mirror OPTS remote [local]<br>下载整个目录(楼上的 get 只能用来抓档案)<br>-c 续传<br>-e 这个要小心一些, 比较远端和本地端的档案, 假如远端没有的, 就将本地端的档案删除, 也就是将本地端和远端资料同步。<br>-R 上传整个目录<br>-n 只下载较新的档案<br>-r 不用递回到目录中<br>–parallel=n 同时下载 n 个档案(预设一次只下载一个)清晰网 </p>
<p>module name args<br>载入模组</p>
<p>put OPTS -o<br>上传档案</p>
<p>mput OPTS<br>上传档案(可用 wildcard expansion 也就是 *)</p>
<p>mv<br>将远端的 file1 改名为 file2</p>
<p>mrm<br>用 wildcard expansion 方式来删除远端档案</p>
<p>open OPTS<br>开启某个站台<br>open -u , -p site</p>
<p>queue OPTS []<br>将 cmd 放到伫列中等待执行<br>-d index 将编号为 index 的 job 删除<br>-m index new_index 将编号为 index 的 job 移至编号 new_index, 插队专用。<br>-n index 在编号 index 之前新增一个 job</p>
<p>wait []<br>将背景执行中的程序移至前景(也可用 fg)</p>
<p>kill all|<br>删除全部的 jobs 或 job_no</p>
<p>repeat delay command<br>每隔 delay 秒, 重覆执行 command, 预设是每隔一秒</p>
<p>rm -r -f<br>移除远端档案</p>
<p>mkdir -p<br>建立远端目录</p>
<p>rmdir -f<br>移除远端目录</p>
<p>set OPT []<br>设定变数<br>直接键入 set 可看目前定义了那些变数</p>
<p>source<br>读取 file, 并执行 file 中的命令(应该是和 bash 中的 source 命令是一样的吧)</p>
<p>debug [|off] -o<br>设定 debug level 为 level<br>-o 将输出导向至 file</p>
<p>exit [|bg]<br>结束 lftp<br>此时若还有 jobs, 则会将 lftp 放至背景执行, 继续未完成的工作</p>
<p>history -w file-r file-c|-l cnt<br>和 bash 中的 history 功能一样</p>
<p>renlist []<br>只显示远端的档名</p>
<p>pwd -p<br>显示目前远端所在目录<br>-p 连登入密码也显示</p>
<p>scache []<br>只打 scache 显示目前所有的 session, 加上 session_no 可切换至其他的 session,<br>对於同时开启多个站台或同个站台不同目录间切换。</p>
<p>国内的大多数ftp服务器使用的中文编码是gbk，而linxu大多数版本（包括debian，redhat，centOS，fc等版本）默认的编码是utf-8,于是会出现访问ftp服务器是出现中文乱码的问题，解决办法有两种：<br>1、临时解决<br>用lftp登录到ftp服务器上，设置远程服务器编码为gbk，而设置本地编码为utf-8，做法为：输入下面两个命令：<br>set ftp:charset gbk<br>set file:charset utf8</p>
<p>2、永久解决<br>在目录$HOME/.lftp编辑文件（如果没有则建立）rc,输入下面两行，设置远程编码为gbk，本地编码为utf-8：<br>set ftp:charset gbk<br>set file:charset utf8<br>这种方法会导致访问utf8编码的服务器时出现中文乱码，不过就目前国内环境来说机会比较少。如果出现乱码时则临时输入下面两行就可以了：<br>set ftp:charset utf8<br>set file:charset utf8</p>
<p>另外一个用的很多的图形界面的ftp客户端是gftp，在选项中可以选择编码，用惯了win下客户端的人应该能够很快的早到编码选择的地方，选择服务器端的编码为gbk就可以了。</p>
<h1 id="Samba服务"><a href="#Samba服务" class="headerlink" title="Samba服务"></a>Samba服务</h1><p>Samba服务程序现在已经成为在Linux系统与Windows系统之间共享文件的最佳选择</p>
<h2 id="SMB协议"><a href="#SMB协议" class="headerlink" title="SMB协议"></a>SMB协议</h2><p>高层协议</p>
<ul>
<li>提供网络上不同主机之间共享文件</li>
<li>为Window客户程序和服务提供了一个通过虚拟链路，按照请求-响应方式进行通信的机制</li>
<li>SMB工作原理是让NetBIOS与SMB协议运行在TCP/IP上，从而让Linux系统在网络邻居中可见</li>
</ul>
<h2 id="CIFS协议"><a href="#CIFS协议" class="headerlink" title="CIFS协议"></a>CIFS协议</h2><ul>
<li>通用网际文件系统是微软服务器消息块协议（SMB）的增强版</li>
<li>提供计算机用户在企业内部网和因特网上共享文件的标准方法 </li>
<li>CIFS在TCP/IP运行，利用英特网上的全球域名服务系统（DNS）增强其可扩展性</li>
</ul>
<h2 id="CIFS协议特点"><a href="#CIFS协议特点" class="headerlink" title="CIFS协议特点"></a>CIFS协议特点</h2><ul>
<li>文件访问的完整性</li>
<li>为慢连接优化</li>
<li>为文件或目录的访问提供安全性</li>
<li>使用同一编码（Unicode）文件名</li>
<li>使用全局文件名</li>
</ul>
<h2 id="Samba服务简介"><a href="#Samba服务简介" class="headerlink" title="Samba服务简介"></a>Samba服务简介</h2><ul>
<li>应用程序，使Linux支持SMB/CIFS协议 </li>
<li>可以运行在所有Unix平台上</li>
<li>Samba应用程序更新较快并是基于GPL协议发行的</li>
</ul>
<h2 id="Samba功能"><a href="#Samba功能" class="headerlink" title="Samba功能"></a>Samba功能</h2><ul>
<li>Linux系统和Window系统实现资源共享</li>
<li>让Linux系统使用Window系统共享的文件和打印机</li>
<li>提供用户认证功能</li>
<li>支持SSL安全套阶层协议</li>
<li>让Linux主机单位Window域控制和Window域成员服务器</li>
<li>让Linux主机担任Wins名字服务器，提供NetBIOS名字解析器</li>
</ul>
<h2 id="Samba提供服务"><a href="#Samba提供服务" class="headerlink" title="Samba提供服务"></a>Samba提供服务</h2><ul>
<li>文件和打印机共享</li>
<li>用户认证和授权</li>
<li>名字解析</li>
<li>浏览（服务通信）</li>
</ul>
<h2 id="Samba的守护进程"><a href="#Samba的守护进程" class="headerlink" title="Samba的守护进程"></a>Samba的守护进程</h2><ul>
<li>Smbd：实现共享和验证授权服务</li>
<li>Nmbd：实现名字解析和浏览服务</li>
</ul>
<h2 id="Samba的软件包"><a href="#Samba的软件包" class="headerlink" title="Samba的软件包"></a>Samba的软件包</h2><ul>
<li>samba-common : 包括Samba服务器和客户端所需要的文件</li>
<li>samba： Samba服务端软件</li>
<li>samba-winbind： 可选的Window服务</li>
<li>samba-client： 客户端软件</li>
<li>samba-swat： Web配置工具</li>
</ul>
<h2 id="Samba服务概览"><a href="#Samba服务概览" class="headerlink" title="Samba服务概览"></a>Samba服务概览</h2><ul>
<li><p>安装： <code>[root@test ~]# yum install samba -y</code> </p>
</li>
<li><p>服务包： samba</p>
</li>
<li><p>服务类型： 由Systemd启动的守护进程</p>
</li>
<li><p>守护进程：</p>
<ul>
<li>/usr/sbin/nmbd</li>
<li>/usr/sbin/smbd</li>
</ul>
</li>
<li><p>监听的端口：</p>
<ul>
<li>NetBIOS： udp 137 138 tcp 139</li>
<li>SMB基于TCP之上： tcp 445 </li>
</ul>
</li>
<li><p>配置文件： /etc/samba/* </p>
</li>
<li><p>相关软件包： samba‐swat, samba‐client , testparm，cifs‐utils</p>
</li>
</ul>
<h2 id="Samba相关工具"><a href="#Samba相关工具" class="headerlink" title="Samba相关工具"></a>Samba相关工具</h2><ul>
<li>服务端工具<ul>
<li>/usr/bin/smbpasswd : 用户设置Samba用户账号和口令</li>
<li>/usr/bin/testparm: 用于检测配置文件的正确性</li>
<li>/usr/bin/smbstatus: 用于查看年网络中的Samba服务器状态</li>
</ul>
</li>
<li>客户端工具：<ul>
<li>/usr/bin/findsmb: 用于查找网络中的Samba服务器</li>
<li>/usr/bin/smbclient: Linux下的samba客户端</li>
<li>/usr/bin/smbget: 基于SMB/CIFS协议的类似于wget工具</li>
<li>/usr/bin/smbtar: 类似于tar工具</li>
</ul>
</li>
</ul>
<h2 id="Samba相关配置"><a href="#Samba相关配置" class="headerlink" title="Samba相关配置"></a>Samba相关配置</h2><ul>
<li>/etc/sysconfig/samba ： 用于设置守护进程的启动参数</li>
<li>/etc/samba/smb.conf     ： 主配置文件</li>
<li>/etc/samba/smbusers  :  用于映射Linux用户和Window用户</li>
<li>/etc/samba/lmhosts   ： 用作与设置NetBIOS名字与IP地址的对应关系</li>
<li>/etc/pam.d/samba     ： 用于Samba服务的PAM相关配置</li>
</ul>
<h2 id="Samba安全等级"><a href="#Samba安全等级" class="headerlink" title="Samba安全等级"></a>Samba安全等级</h2><ul>
<li>User：由本地Samba服务器负责账户验证     </li>
<li>使用smbpasswd 设置账号（默认的安全等级）</li>
</ul>
<h2 id="Samba账户及口令数据库"><a href="#Samba账户及口令数据库" class="headerlink" title="Samba账户及口令数据库"></a>Samba账户及口令数据库</h2><ul>
<li>账户/口令的工作机制和系统本省分离开来</li>
<li>当设置User安全等级之后，账户验证将有Samba服务器本地进行</li>
<li>用.tdb 格式的口令数据库，初始情况下口令数据库文件并不存在</li>
<li>在创建Samba用户时可以创建口令数据库文件</li>
<li>管理员可以使用smbpasswd命令配置smaba账户及口令</li>
</ul>
<h2 id="默认配置文件"><a href="#默认配置文件" class="headerlink" title="默认配置文件"></a>默认配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># cat /etc/samba/smb.conf | grep -Ev &quot;^$|^#&quot;</span></span><br><span class="line">[global]	<span class="comment"># 全局参数</span></span><br><span class="line">    workgroup = SAMBA</span><br><span class="line">    security = user</span><br><span class="line">    passdb backend = tdbsam</span><br><span class="line">    printing = cups</span><br><span class="line">    printcap name = cups</span><br><span class="line">    netbios name = MYSERVER <span class="comment"># 解析ip</span></span><br><span class="line">    log_level= 2  <span class="comment"># 设置日志级别</span></span><br><span class="line">    host_deny/allow</span><br><span class="line">    config file xxx <span class="comment"># 每个用户有独立的配置文件</span></span><br><span class="line">    <span class="comment"># 打印机启动参数 </span></span><br><span class="line">    load printers = yes</span><br><span class="line">    cups options = raw</span><br><span class="line">[homes]		<span class="comment"># 共享参数</span></span><br><span class="line">    comment = Home Directories</span><br><span class="line">    valid users = %S, %D%w%S</span><br><span class="line">    browseable = No</span><br><span class="line">    <span class="built_in">read</span> only = No</span><br><span class="line">    inherit acls = Yes</span><br><span class="line">[printers]	<span class="comment"># 共享打印机参数</span></span><br><span class="line">    comment = All Printers</span><br><span class="line">    path = /var/tmp</span><br><span class="line">    printable = Yes</span><br><span class="line">    create mask = 0600</span><br><span class="line">    browseable = No</span><br><span class="line">[<span class="built_in">print</span>$]	<span class="comment"># 扩展参数</span></span><br><span class="line">    comment = Printer Drivers</span><br><span class="line">    path = /var/lib/samba/drivers</span><br><span class="line">    write list = @printadmin root</span><br><span class="line">    force group = @printadmin</span><br><span class="line">    create mask = 0664</span><br><span class="line">    directory mask = 0775</span><br></pre></td></tr></table></figure>
<h2 id="Samba服务权限"><a href="#Samba服务权限" class="headerlink" title="Samba服务权限"></a>Samba服务权限</h2><ul>
<li>所以在使用Samba服务共享资源的时候涉及到本地文件系统权限和Samba本身权限<ul>
<li>本地文件系统权限管理：chown chmod selinux (x)</li>
<li>Samba本身权限： 配置文件中使用相关参数去控制</li>
</ul>
</li>
</ul>
<h2 id="Samba服务部署"><a href="#Samba服务部署" class="headerlink" title="Samba服务部署"></a>Samba服务部署</h2><p>更多信息可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevingrace/p/8662088.html">https://www.cnblogs.com/kevingrace/p/8662088.html</a></p>
<p>第1步：创建用于访问共享资源的账户信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># useradd wangwu &amp;&amp; pdbedit -a -u wangwu</span></span><br><span class="line">	pdbedit命令：</span><br><span class="line">	-a ：建立Samba用户</span><br><span class="line">	-x 用户名：删除Samba用户</span><br><span class="line">	-L：列出用户列表</span><br><span class="line">	-Lv：列出用户详细信息的列表</span><br><span class="line">	-u：指定用户</span><br><span class="line"><span class="comment"># 或者使用smbpassed</span></span><br><span class="line">	-a: 建立用户</span><br><span class="line">	不加：更改密码</span><br><span class="line">	-x：删除用户</span><br></pre></td></tr></table></figure>
<p>第2步：创建用于共享资源的文件目录<br><code>[root@node1 ~]# mkdir /home/database</code><br><code>[root@node1 ~]# chown -Rf wangwu:wangwu /home/database</code></p>
<p>第3步：修改主配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">每个共享目录应该有独立的[ ]部分</span><br><span class="line">[共享名称]远程网络看到的共享名称</span><br><span class="line">comment注释信息</span><br><span class="line">path所共享的目录路径</span><br><span class="line">public能否被guest访问的共享,默认no,和guest ok类似</span><br><span class="line">browsable是否允许所有用户浏览此共享默认为yes,no为隐藏</span><br><span class="line">writable&#x3D;yes可以被所有用户读写，默认为no</span><br><span class="line">read only&#x3D;no和writable&#x3D;yes等价，如与以上设置冲突,放在后面的设置生效,默认只读</span><br><span class="line">write list 用户，@组名，+组名,用，分隔，如writable&#x3D;no, 列表中用户或组可读写,不在列表中用户只读</span><br><span class="line">valid users特定用户才能访问该共享,如为空,将允许所有用户，用户名之间用空格分隔,@组名，+组名,用，分隔</span><br></pre></td></tr></table></figure>
<p>添加如下配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">comment = this is my <span class="built_in">test</span> </span><br><span class="line">path = /home/database</span><br><span class="line">public = no</span><br><span class="line">writable = yes</span><br></pre></td></tr></table></figure>
<p>第4步：正确性检查</p>
<p><code>[root@node1 ~]# testparm  --show-all-paraments</code><br><code>[root@node1 ~]# systemctl restart smb</code><br><code>[root@node1 ~]# netstat -lunt | egrep &#39;137|138|139|445&#39;</code></p>
<p>第5步：测试</p>
<ul>
<li><p>Window挂载共享</p>
<pre><code>在Window运行输入地址：\\\192.168.10.10
用户名：wangwu
密码：wangwu</code></pre>
</li>
<li><p>Linux挂载共享<br>Samba提供了一个类似FTP客户程序的Samba客户程序smbclient<br>使用方法：smbclient //NetBIOS名或IP地址/共享名 -U 用户名<br><code>[root@node1 ~]# yum install samba-client -y</code><br><code>[root@node1 ~]# smbclient -L //192.168.10.10/database -U kinmfer</code>     #检查Samba资源<br><code>smbstatus</code>命令：列出Samba的资源使用情况</p>
</li>
<li><p>或者使用挂载命令</p>
<ul>
<li><p>手动挂载</p>
<p><code>mount -o username=xxx password=xxx //smbshare/server /mnt/xxx</code></p>
</li>
<li><p>开机自动挂载</p>
<p>此方法需要安装cifs-utils包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;//172.16.1.31/share /mnt cifs credentials或cred=/etc/smb.txt 0 0&#x27;</span> &gt;&gt; /etc.fstab</span><br><span class="line"></span><br><span class="line">cat /etc/smb.txt</span><br><span class="line">username=xxx</span><br><span class="line">password=xxx</span><br><span class="line"></span><br><span class="line">chmod 600 /etc/smb.txt</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h1 id="NFS服务"><a href="#NFS服务" class="headerlink" title="NFS服务"></a>NFS服务</h1><ul>
<li><p>网络文件系统，英文Network File System(NFS)。是由SUN公司研制的UNIX表示层协议(pressentation layer protocol)，能使使用者访问网络上别处的文件就像在使用自己的计算机一样。</p>
</li>
<li><p>它允许网络中的计算机之间通过TCP/IP网络共享资源。在NFS的应用中，本地NFS的客户端应用可以透明地读写位于远端NFS服务器上的文件，就像访问本地文件一样，也就是说客户端PC可以挂载NFS服务器所提供的目录并且挂载之后这个目录看起来如同本地的磁盘分区一样，可以使用cp、cd、mv、rm及df等与磁盘相关的命令。</p>
</li>
<li><p>它基于开放网络运算远程过程调用（ONC RPC）协议：一个开放、标准的RFC协议，任何人或组织都可以依据标准实现它。</p>
</li>
<li><p>远程过程调用Remote Procedure Call，缩写为 RPC,是一个计算机通信协议。该协议允许运行于一台计算机的程序调用另一个地址空间（通常为一个开放网络的一台计算机）的子程序，而程序员就像调用本地程序一样，无需额外地为这个交互作用编程（无需关注细节）。RPC是一种服务器-客户端（Client/Server）模式，经典实现是一个通过发送请求-接受回应进行信息交互的系统。</p>
</li>
<li><p>NFS服务端、RPC协议、客户端三者可以理解为房源、中介、租客之间的关系：</p>
<ul>
<li>首先服务器端启动RPC服务，并开启111端口</li>
<li>服务器端启动NFS服务，并向RPC注册端口信息</li>
<li>客户端启动RPC（portmap服务），向服务端的RPC(portmap)服务请求服务端的NFS端口</li>
<li>服务端的RPC(portmap)服务反馈NFS端口信息给客户端。</li>
<li>客户端通过获取的NFS端口来建立和服务端的NFS连接并进行数据的传输。</li>
</ul>
<p><img src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/image-20200502192135749.png" alt="image-20200502192135749"></p>
<p><img src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/7355130-62a8b707e67943ba.webp" alt="7355130-62a8b707e67943ba"> </p>
</li>
</ul>
<h1 id="NFS服务搭建"><a href="#NFS服务搭建" class="headerlink" title="NFS服务搭建"></a>NFS服务搭建</h1><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><ul>
<li><p>服务端</p>
<p><code>[root@nfs01 ~]# dnf install rpcbind nfs-utils -y</code></p>
</li>
<li><p>客户端</p>
<p><code>[root@web01 ~]# dnf install nfs-utils -y</code></p>
</li>
</ul>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><blockquote>
<p>注意：先启动rpc服务，在启动nfs服务</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># systemctl start rpcbind</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># systemctl enable rpcbind   </span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># systemctl start nfs-server.service </span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># systemctl enable nfs-server.service </span></span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service → /usr/lib/systemd/system/nfs-server.service.</span><br></pre></td></tr></table></figure>
<p>没有注册时候：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rpcinfo -p 172.16.1.31</span></span><br><span class="line">program vers proto   port  service</span><br><span class="line">100000    4   tcp    111  portmapper</span><br><span class="line">100000    3   tcp    111  portmapper</span><br><span class="line">100000    2   tcp    111  portmapper</span><br><span class="line">100000    4   udp    111  portmapper</span><br><span class="line">100000    3   udp    111  portmapper</span><br><span class="line">100000    2   udp    111  portmapper	</span><br></pre></td></tr></table></figure>
<p>nfs服务注册之后信息：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rpcinfo -p 172.16.1.31</span></span><br><span class="line">program vers proto   port  service</span><br><span class="line">100000    4   tcp    111  portmapper</span><br><span class="line">100000    3   tcp    111  portmapper</span><br><span class="line">100000    2   tcp    111  portmapper</span><br><span class="line">100000    4   udp    111  portmapper</span><br><span class="line">100000    3   udp    111  portmapper</span><br><span class="line">100000    2   udp    111  portmapper</span><br><span class="line">100024    1   udp  53997  status</span><br><span class="line">100024    1   tcp  49863  status</span><br><span class="line">100005    1   udp  20048  mountd</span><br><span class="line">100005    1   tcp  20048  mountd</span><br><span class="line">100005    2   udp  20048  mountd</span><br><span class="line">100005    2   tcp  20048  mountd</span><br><span class="line">100005    3   udp  20048  mountd</span><br><span class="line">100005    3   tcp  20048  mountd</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><h4 id="创建目录并授权"><a href="#创建目录并授权" class="headerlink" title="创建目录并授权"></a>创建目录并授权</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mkdir -p /data/web01</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># chown -R nobody.nobody /data</span></span><br></pre></td></tr></table></figure>
<p>配置文件说明：</p>
<blockquote>
<p>格式： 共享目录的路径 允许访问的NFS客户端（共享权限参数）</p>
<p>如上，共享目录为/public , 允许访问的客户端为192.168.245.0/24网络用户，权限为只读。</p>
<p>请注意，NFS客户端地址与权限之间没有空格。</p>
<p>NFS输出保护需要用到kerberos加密（none，sys，krb5，krb5i，krb5p），格式sec=XXX</p>
<p>none：以匿名身份访问，如果要允许写操作，要映射到nfsnobody用户，同时布尔值开关要打开，setsebool nfsd_anon_write 1</p>
<p>sys：文件的访问是基于标准的文件访问，如果没有指定，默认就是sys， 信任任何发送过来用户名</p>
<p>krb5：客户端必须提供标识，客户端的表示也必须是krb5，基于域环境的认证</p>
<p>krb5i：在krb5的基础上做了加密的操作，对用户的密码做了加密，但是传输的数据没有加密</p>
<p>krb5p：所有的数据都加密</p>
</blockquote>
<h4 id="配置文件的参数"><a href="#配置文件的参数" class="headerlink" title="配置文件的参数"></a>配置文件的参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ro</td>
<td>只读</td>
</tr>
<tr>
<td>rw</td>
<td>读写</td>
</tr>
<tr>
<td>root_squash</td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td>no_root_squash</td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的root管理员</td>
</tr>
<tr>
<td>all_squash</td>
<td>无论NFS客户端使用什么账户访问，均映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td>no_all_squash</td>
<td>不要将普通用户身份进行转换</td>
</tr>
<tr>
<td>sync</td>
<td>请求或写入数据时，数据同步写入到NFS Server的硬盘后才返回，优点：数据安全不会丢，缺点：性能比不启用该参数要差</td>
</tr>
<tr>
<td>async</td>
<td>写入数据时会先写到内存缓冲区，直到硬盘有空档才会在写入磁盘，这样可以提升写入效率。风险是若服务器宕机或不正常关机，会损失缓冲区中未写入硬盘的数据（解决办法：服务器主板电池或UPS不间断电源）</td>
</tr>
<tr>
<td>anonuid</td>
<td>参数以anon*开头即值anonymous匿名用户，这个用户的UID设置值通常为nfsnobody的UID值，当然我们也可以自行设置这个UID值。但是，UID必须存在于/etc/passwd中。在多个NFS Clients时，如多台web server共享一个NFS目录时，通过这个参数可以使得不同的NFS Clients写入的数据对所有NFS Clients保持同样的用户权限，即为配置的匿名UID对应用户权限，这个参数很有用。一般默认就好</td>
</tr>
<tr>
<td>anongid</td>
<td>指定gid的值</td>
</tr>
</tbody></table>
<p>企业互联网公司如何配置NFS 各种squash参数</p>
<ul>
<li>no_all_squash  需要进行配置   共享目录权限为www（可以自己定义）（<strong>确保客户端用户 服务端用户 uid数值一致</strong>，需要在/etc/exports中定义anonuid）</li>
<li>root_squash    需要进行配置</li>
</ul>
<blockquote>
<p>如何让root用户可以操作管理www用户管理的data目录<br>root  — root_squash — www  —操作— data目录<br>anonuid=65534,anongid=65534    — 可以指定映射的用户信息</p>
</blockquote>
<p>当然，保证网站存储服务器用户数据安全性，默认配置文件中已经定义了以上配置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/data 172.16.1.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line">/data 192.168.242.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br></pre></td></tr></table></figure>
<p>企业中如何编辑nfs配置文件</p>
<ol>
<li>通用方法 *****<br>/data   172.16.1.0/24(rw,sync)</li>
<li>特殊情况 （让部分人员不能操作存储目录 可以看目录中的数据）<br>/data   10.0.0.0/24(ro,sync)</li>
<li>修改默认的匿名用户<br>/data   10.0.0.0/24(ro,sync,anonuid=xxx,anongid=xxx)</li>
</ol>
<p>配置完成后，使用exportfs实用程序有选择地导出目录，而无需重新启动NFS服务</p>
<p>用<code>exportfs</code>命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># exportfs -rv</span></span><br><span class="line">exporting 172.16.1.0/24:/data</span><br><span class="line">exporting 192.168.242.0/24:/data</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>全部挂载或者全部卸载</td>
</tr>
<tr>
<td>-r</td>
<td>重新挂载</td>
</tr>
<tr>
<td>-u</td>
<td>卸载某一个目录</td>
</tr>
<tr>
<td>-v</td>
<td>显示共享目录</td>
</tr>
</tbody></table>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><p>启动：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 mnt]<span class="comment"># systemctl start nfs-server.service </span></span><br><span class="line">[root@web01 mnt]<span class="comment"># systemctl enable nfs-server.service </span></span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service → /usr/lib/systemd/system/nfs-server.service.</span><br></pre></td></tr></table></figure>
<p>输入命令：<code>mount -t nfs 172.16.1.31:/data /mnt</code></p>
<p>检查：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 mnt]<span class="comment"># df -h</span></span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs             383M     0  383M    0% /dev</span><br><span class="line">tmpfs                399M     0  399M    0% /dev/shm</span><br><span class="line">tmpfs                399M   11M  388M    3% /run</span><br><span class="line">tmpfs                399M     0  399M    0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/cl-root  3.5G  1.6G  1.9G   46% /</span><br><span class="line">/dev/sda1            976M  190M  720M   21% /boot</span><br><span class="line">tmpfs                 80M     0   80M    0% /run/user/0</span><br><span class="line">172.16.1.31:/data    3.5G  1.7G  1.9G   47% /mnt</span><br></pre></td></tr></table></figure>
<p>如何实现自动挂载：</p>
<ol>
<li><p>利用rc.local<br><code>echo &quot;mount -t nfs 172.16.1.31:/data /mnt&quot; &gt;&gt;/etc/rc.local</code></p>
</li>
<li><p>利用fstab文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fstab</span><br><span class="line">172.16.1.31:/data                         /mnt                    nfs     defaults        0 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：有很多资料建议写入到/etc/fstab,os启动时一般会先加载文件系统后启动网络，在没有网络时nfs是无法加载的，总是出错， 虽然有类似所以还是建议放到/etc/rc.local中</p>
</blockquote>
</li>
</ol>
<p><strong>如果在/mnt下新建目录挂载，如上所述，需要将客户端的xxx用户id修改为和服务端一致，否则会出现Permission denied</strong></p>
<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><p><code>umount -lf /mnt</code>    强制卸载挂载点</p>
<ul>
<li>-l       不退出挂载点目录进行卸载 </li>
<li>-f       强制进行卸载操作</li>
</ul>
<h4 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h4><p>利用<code>showmount</code>命令检查有权限挂载的服务器是否能够挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 mnt]<span class="comment"># showmount -e</span></span><br><span class="line">Export list <span class="keyword">for</span> web01:</span><br><span class="line">[root@web01 mnt]<span class="comment"># showmount -e 172.16.1.31</span></span><br><span class="line">Export list <span class="keyword">for</span> 172.16.1.31:</span><br><span class="line">/data 192.168.242.0/24,172.16.1.0/24</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>常用参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>仅显示已被NFS客户端加载的目录</td>
</tr>
<tr>
<td>-e</td>
<td>显示NFS服务器上所有的共享目录</td>
</tr>
</tbody></table>
<h2 id="NFS排错"><a href="#NFS排错" class="headerlink" title="NFS排错"></a>NFS排错</h2><h3 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h3><ol>
<li><p>检查nfs进程信息是否注册</p>
<p><code>rpcinfo -p localhost/172.16.1.31</code><br>问题原因：</p>
<ul>
<li>服务启动顺序不对</li>
<li>没有启动nfs服务</li>
</ul>
</li>
<li><p>检查有没有可用存储目录<br><code>showmount -e 172.16.1.31</code><br>问题原因：<br>配置文件编写有问题，重启nfs服务</p>
</li>
<li><p>在服务端进行挂载测试</p>
<p>是否能够在存储目录中创建或删除数据</p>
</li>
</ol>
<h3 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h3><ol>
<li><p>检查nfs进程信息是否注册<br><code>rpcinfo -p localhost/172.16.1.31</code></p>
<p>问题原因：</p>
<ul>
<li><p>没有启动nfs服务</p>
</li>
<li><p>服务启动顺序不对</p>
</li>
</ul>
<ol start="2">
<li><p>检查有没有可用存储目录<br><code>showmount -e 172.16.1.31</code><br>问题原因：<br>配置文件编写有问题，重启nfs服务</p>
</li>
<li><p>网络问题<br><code>ping 172.16.1.31</code></p>
<p><code>telnet 172.16.1.31 111</code></p>
</li>
</ol>
</li>
</ol>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li><p>示例1：客户端挂载报错“No such file or directory”</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01t ~]<span class="comment"># showmount -e 172.16.1.31</span></span><br><span class="line">Export list <span class="keyword">for</span> 172.16.1.31:</span><br><span class="line">/data    172.16.1.0/24</span><br><span class="line">[root@nfs01 ~]<span class="comment"># mount -t nfs 172.16.1.31:/data /mnt</span></span><br><span class="line">mount.nfs: mounting 172.16.1.31:/data failed, reason given by server: No such file or directory</span><br></pre></td></tr></table></figure>
<p>解答：原因是NFS服务器端没有共享目录/data，创建即可。命令如下：<br><code>[root@nfs-server ~]# mkdir /data</code></p>
</li>
<li><p>示例2：NFS服务器端启动失败，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># systemctl start nfs-server</span></span><br><span class="line">Starting NFS services:								[  OK  ]</span><br><span class="line">Starting NFS quotas: Cannot register service: RPC: Unable to receive; errno = Connection refused</span><br><span class="line">rpc.rquotad: unable to register (RQUOTAPROG, RQUOTAVERS, udp).</span><br><span class="line"> 												    [FAILED]</span><br><span class="line">Starting NFS mountd:								[FAILED]</span><br><span class="line">Starting NFS daemon: rpc.nfsd: writing fd to kernel failed: errno 111 (Connection refused)</span><br><span class="line">rpc.nfsd: unable to <span class="built_in">set</span> any sockets <span class="keyword">for</span> nfsd		[FAILED]</span><br></pre></td></tr></table></figure>
<p>解答：这是因为RPC服务没有在NFS前面启动，需要先启动RPC服务再启动NFS，解决方法为，按顺序启动rpcbind及NFS，命令如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs-server ~]<span class="comment"># systemctl start rpcbind</span></span><br><span class="line">[root@nfs-server ~]<span class="comment"># systemctl start nfs-server</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例3：注册RPC服务失败，出现failed：RPC Error：Program not registered错误。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mount -t nfs 172.16.1.31:/data /mnt</span></span><br><span class="line">mount.nfs: requested NFS version or transport protocol is not supported</span><br><span class="line">[root@nfs-client ~]<span class="comment"># showmount -e 172.16.1.31</span></span><br><span class="line">clnt_create: RPC: Program not registered</span><br></pre></td></tr></table></figure>
<p>解答：服务器端的NFS没有启动，客户端没有收到服务器端发来的随机端口信息。<br>解决方法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs-server ~]<span class="comment"># systemctl restart rpcbind</span></span><br><span class="line">[root@nfs-server ~]<span class="comment"># systemctl restart nfs-server</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例4：卸载挂载设备时显示device is busy。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 mnt]<span class="comment"># umount /mnt</span></span><br><span class="line">umount.nfs: /mnt: device is busy</span><br><span class="line">umount.nfs: /mnt: device is busy</span><br></pre></td></tr></table></figure>
<p>解答：有可能是当前目录就是挂载的NFS目录（/mnt），也有可能是NFS Server挂了。对于第一种情况，解决办法为退出挂载目录/mnt，再执行umount /mnt卸载。对于第二种情况，NFS Server挂了，NFS Client就会出现问题（df -h窗口会死掉），这时只能强制卸载，方法为：<br><code>umount -lf /mnt</code>     其中的参数-f为强制卸载，参数-l为懒惰的卸载。</p>
</li>
<li><p>示例5：CentOS 6.6客户端NFS挂载时遇到问题。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mount -t nfs 172.16.1.9:/data /mnt</span></span><br><span class="line">mount：wrong fs <span class="built_in">type</span>，bad option，bad option，bad superblock on 10.0.0.7:/data,</span><br><span class="line">   missing codepage or helper program，or other error</span><br><span class="line">   (<span class="keyword">for</span> several filesystems (e.g. nfs, cifs) you might</span><br><span class="line">need a /sbin/mount.&lt;<span class="built_in">type</span>&gt; helper program )</span><br><span class="line">In some cases useful info is found <span class="keyword">in</span> syslog - try</span><br><span class="line">meg | tail or so</span><br></pre></td></tr></table></figure>
<p>排查思路：同样的机器，NFS服务器本地可以挂载，但是客户端挂载时wrong fs type，因此尝试所有客户端安装nfs-utils。CentOS6.5及以前的NFS没有遇到这个问题。<br>解决方法：执行<code>yum install nfs-utils -y</code>，客户端安装NFS软件，但不启动服务。</p>
</li>
<li><p>示例六：共享目录挂载很卡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mount -t nfs 172.16.1.31:/data /mnt</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># cd /mnt</span></span><br><span class="line">time touch test.txt</span><br></pre></td></tr></table></figure>
<p>原因分析：</p>
<ul>
<li>NFS服务端重启之后。立刻进行挂载会出现此问题，因为NFS自身重启的时候，拥有无敌的时间，默认是90秒；在无敌时间内，是不能对共享目录进行更改的操作；</li>
<li>在系统配置中/etc/sysconfig/nfs中指定了无敌时间的配置参数<br>NFSD_V4_GRACE=90<br>NFSD_V4_LEASE=90<br>NLM_GRACE_PERI0D=90<br>find /proc -name | grep -i ” NLM_GRACE_PERIOD”<br>find /proc -iname ” NLM_GRACE_PERIOD”</li>
<li>重启NFS服务没有按照顺序进行重启，一旦NFS重启了，需要确认rpcbind服务有没有接收，即rpcinfo -p localhost；先启动rpcbind服务再启动nfs服务</li>
</ul>
</li>
<li><p>示例七：ls: cannot open directory .: Stale file handle<br>Stale file handle<br>客户端报错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mount -t nfs 172.16.1.9:/data  /mnt</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># mount.nfs: Stale file handle</span></span><br></pre></td></tr></table></figure>
<p>服务端挂载报错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 data]<span class="comment"># mount -t nfs 172.16.1.31:/data /mnt/</span></span><br><span class="line">mount.nfs: access denied by server <span class="keyword">while</span> mounting 172.16.1.31:/data</span><br></pre></td></tr></table></figure>
<p>查看配置文件发现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 data]<span class="comment"># cat /etc/exports</span></span><br><span class="line"><span class="comment">#share /data  by lidao  at 20160913</span></span><br><span class="line">/data 173.16.1.0/24(rw,sync)</span><br></pre></td></tr></table></figure>
<p>原因分析：</p>
<p>/proc/mounts客户端挂载文件中已经存在了相应的挂载记录，没有正确卸载掉，就再次进行挂载，就会出现以上错误。</p>
</li>
</ul>
<h1 id="Rsync"><a href="#Rsync" class="headerlink" title="Rsync"></a>Rsync</h1><p>rsync，英文全称是 remote synchronize， 是一款实现远程同步功能的免费软件，它在同步文件的同时，可以保持原来文件的权限、时间、软硬链接等附加信息。 rsync 是用 “rsync 算法”提供了一个客户机和远程文件服务器的文件同步的快速方法，而且可以通过 ssh 方式来传输文件。 甚至还可以实现只同步一个文件里有变化的内容部分，所以可以实现快速的同步备份数据。同时， rsync 还可以实现同步本地数据、删除文件和目录的功能。一个 rsync 相当于 scp、 cp、 rm，并且还在性能上优于它们每一个命令。</p>
<h2 id="Rsync特性"><a href="#Rsync特性" class="headerlink" title="Rsync特性"></a>Rsync特性</h2><ul>
<li>能更新整个目录和树和文件系统；</li>
<li>有选择性的保持符号链链、硬链接、文件属于、权限、设备以及时间等；</li>
<li>对于安装来说，无任何特殊权限要求；</li>
<li>对于多个文件来说，内部流水线减少文件等待的延时；</li>
<li>能用 rsh、 ssh 或直接端口做为传输入端口（rsync 本身不对数据加密）；</li>
<li>支持匿名 rsync 同步文件，是理想的镜像工具；</li>
</ul>
<h2 id="Rsync在企业的工作场景"><a href="#Rsync在企业的工作场景" class="headerlink" title="Rsync在企业的工作场景"></a>Rsync在企业的工作场景</h2><ul>
<li>服务器之间的数据同步（cron+rsync）</li>
<li>把所有客户服务器数据同步到备份服务器（cron+rsync）</li>
<li>与 inotify 或 sersync 配合，做实时的数据同步（rsync+inotify/sersync）</li>
</ul>
<h2 id="Rsync命令行常用参数"><a href="#Rsync命令行常用参数" class="headerlink" title="Rsync命令行常用参数"></a>Rsync命令行常用参数</h2><ul>
<li><p>参数说明</p>
<ul>
<li>-v：–verbose 详细模式输出</li>
<li>-z：–compress 对备份的文件在传输的过程中进行压缩处理</li>
<li>-a：–archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于参数：-vrztopg</li>
<li>-r：–recursive 对子目录以递归模式处理。</li>
<li>-t：–times 保持文件时间信息</li>
<li>-o：–owner 保持文件属主信息。</li>
<li>-p：–perms 保持文件权限。</li>
<li>-g：–group 保持文件属组信息</li>
<li>-D：–devices 保持设备文件信息</li>
<li>-l： –links 保留软链结。</li>
<li>-e：–rsh=command 指定使用 rsh、 ssh 方式进行数据同步</li>
<li>–exclude=PATTERN 指定排除不需要传输的文件模式。</li>
<li>–exclude-from=FILE 排除 FILE 中指定模式的文件。</li>
<li>–bwlimit=KBPS 限制 I/O 带宽， KBytes per second。</li>
<li>–delete 无差异同步参数(慎用),删除那些目标位置有的文件而备份源没有的文件</li>
</ul>
</li>
<li><p>工作中常用参数组合：-avz</p>
</li>
</ul>
<h2 id="Rsync优缺点"><a href="#Rsync优缺点" class="headerlink" title="Rsync优缺点"></a>Rsync优缺点</h2><ul>
<li>优点<br>（1）增量备份，支持socket（daemon），集中备份（支持推拉，都是以客户端为参照物）<br>  　　（2）远程shell通道模式还可以加密（ssh）传输，socket（daemon）需要加密传输，可以利用vpn服务或ipsec服务</li>
<li>缺点：<br>（1）大量小文件同步的时候，比对时间较长，有的时候，rsync进程可能会停止<br>（2）同步大文件，10G这样的大文件有时也会出现问题：中断。未完整同步前，是隐藏文件，可以通过续传等参数实现传输。一次性远程拷贝可以用scp</li>
</ul>
<h2 id="Rsync部署"><a href="#Rsync部署" class="headerlink" title="Rsync部署"></a>Rsync部署</h2><h3 id="服务端-2"><a href="#服务端-2" class="headerlink" title="服务端"></a>服务端</h3><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><p>安装软件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@backup ~]<span class="comment"># rpm -qa | grep rsync</span></span><br><span class="line">rsync-3.1.3-6.el8.x86_64</span><br></pre></td></tr></table></figure>
<p>如果rsync软件不存在： <code>dnf install -y rsync</code></p>
<h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>编写rsync软件的配置文件</p>
<p><code>vim /etc/rsyncd.conf </code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">uid = rsync       --- 指定管理备份目录的用户  </span><br><span class="line">gid = rsync       --- 指定管理备份目录的用户组</span><br><span class="line">port = 873        --- 定义rsync备份服务的网络端口号</span><br><span class="line">fake super = yes  --- 将rsync虚拟用户伪装成为一个超级管理员用户 </span><br><span class="line">use chroot = no   --- 和安全相关的配置</span><br><span class="line">max connections = 200  --- 最大连接数  同时只能有200个客户端连接到备份服务器</span><br><span class="line">timeout = 300          --- 超时时间(单位秒)</span><br><span class="line">pid file = /var/run/rsyncd.pid   --- 记录进程号码信息 1.让程序快速停止进程 2. 判断一个服务是否正在运行</span><br><span class="line">lock file = /var/run/rsync.lock  --- 锁文件</span><br><span class="line"><span class="built_in">log</span> file = /var/<span class="built_in">log</span>/rsyncd.log   --- rsync服务的日志文件 用于排错分析问题</span><br><span class="line">ignore errors                    --- 忽略传输中的简单错误</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span>                --- 指定备份目录是可读可写</span><br><span class="line">list = <span class="literal">false</span>                     --- 使客户端可以查看服务端的模块信息</span><br><span class="line">hosts allow = 172.16.1.0/24      --- 允许传输备份数据的主机(白名单)</span><br><span class="line">hosts deny = 0.0.0.0/32          --- 禁止传输备份数据的主机(黑名单)</span><br><span class="line">auth users = rsync_backup        --- 指定认证用户 </span><br><span class="line">secrets file = /etc/rsync.password   --- 指定认证用户密码文件 用户名称:密码信息</span><br><span class="line">[backup]                         --- 模块信息</span><br><span class="line">comment = <span class="string">&quot;backup dir by oldboy&quot;</span>  </span><br><span class="line">path = /backup                   --- 模块中配置参数 指定备份目录</span><br></pre></td></tr></table></figure>
<h4 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h4><p>创建rsync服务的虚拟用户</p>
<p><code>useradd rsync -M -s /sbin/nologin</code></p>
<h4 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h4><p>创建备份服务认证密码文件并改权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rsync_backup:123123&quot;</span> &gt;/etc/rsync.password</span><br><span class="line">chmod 600 /etc/rsync.password</span><br></pre></td></tr></table></figure>
<h4 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h4><p>建备份目录并修改属主属组信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /backup</span><br><span class="line">chown -R rsync.rsync /backup/</span><br></pre></td></tr></table></figure>
<h4 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h4><p>启动rsync守护进程服务</p>
<p><code>rsync --daemon</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@backup ~]<span class="comment"># ps -ef | grep rsync</span></span><br><span class="line">root        901      1  0 12:07 ?        00:00:00 rsync --daemon</span><br><span class="line">root       1432   1405  0 12:09 pts/0    00:00:00 grep --color=auto rsync</span><br></pre></td></tr></table></figure>
<h4 id="第七步"><a href="#第七步" class="headerlink" title="第七步"></a>第七步</h4><p>需要熟悉rsync守护进程名称语法:</p>
<p>Access via rsync daemon:</p>
<ul>
<li><p>客户端做拉的操作: 恢复数据</p>
<p>pull: rsync [OPTION…] [USER@]HOST::SRC… [DEST]</p>
<p>​        rsync [OPTION…] rsync://[USER@]HOST[:PORT]/SRC… [DEST]</p>
</li>
<li><p>客户端做推的操作: 备份数据</p>
<p>Push: rsync [OPTION…] SRC… [USER@]HOST::DEST</p>
<p>src: 要推送备份数据信息</p>
<p>[USER@]: 指定认证用户信息</p>
<p>HOST: 指定远程主机的IP地址或者主机名称<br>::DEST: 备份服务器的模块信息</p>
<p>rsync [OPTION…] SRC… rsync://[USER@]HOST[:PORT]/DEST</p>
</li>
</ul>
<h3 id="客户端-2"><a href="#客户端-2" class="headerlink" title="客户端"></a>客户端</h3><h4 id="第一步-1"><a href="#第一步-1" class="headerlink" title="第一步"></a>第一步</h4><p>创建密码文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;123123&quot;</span> &gt;/etc/rsync.password</span><br><span class="line">chmod 600 /etc/rsync.password</span><br></pre></td></tr></table></figure>
<h4 id="第二步-1"><a href="#第二步-1" class="headerlink" title="第二步"></a>第二步</h4><p>进行免交互传输数据测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rsync -avz /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span></span><br><span class="line">sending incremental file list</span><br><span class="line">hosts</span><br><span class="line">sent 227 bytes  received 43 bytes  180.00 bytes/sec</span><br><span class="line">total size is 371  speedup is 1.37</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>检查服务端</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@backup ~]<span class="comment"># ll /backup/hosts -d</span></span><br><span class="line">-rw-r--r-- 1 rsync rsync 371 3月  27 07:23 /backup/hosts</span><br></pre></td></tr></table></figure>
<h2 id="守护进程服务企业应用"><a href="#守护进程服务企业应用" class="headerlink" title="守护进程服务企业应用"></a>守护进程服务企业应用</h2><h3 id="守护进程多模块功能配置"><a href="#守护进程多模块功能配置" class="headerlink" title="守护进程多模块功能配置"></a>守护进程多模块功能配置</h3><p>在配置文件中添加如下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">backup</span>]</span><br><span class="line"><span class="string">comment</span> <span class="string">=</span> <span class="string">&quot;backup dir by kinmfer&quot;</span></span><br><span class="line"><span class="string">path</span> <span class="string">=</span> <span class="string">/backup</span></span><br><span class="line">[<span class="string">dba</span>]</span><br><span class="line"><span class="string">comment</span> <span class="string">=</span> <span class="string">&quot;backup dir by kinmfer&quot;</span></span><br><span class="line"><span class="string">path</span> <span class="string">=</span> <span class="string">/dba</span></span><br><span class="line">[<span class="string">dev</span>]</span><br><span class="line"><span class="string">comment</span> <span class="string">=</span> <span class="string">&quot;backup dir by kinmfer&quot;</span></span><br><span class="line"><span class="string">path</span> <span class="string">=</span> <span class="string">/devdata</span></span><br></pre></td></tr></table></figure>
<h3 id="守护进程的排除功能实践"><a href="#守护进程的排除功能实践" class="headerlink" title="守护进程的排除功能实践"></a>守护进程的排除功能实践</h3><ul>
<li>准备环境</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># mkdir -p /kinmfer/&#123;a..c&#125;</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># touch /kinmfer/&#123;a..c&#125;/&#123;1..3&#125;.txt</span></span><br><span class="line">[root@nfs01 ~]<span class="comment"># tree /kinmfer</span></span><br><span class="line">/kinmfer</span><br><span class="line">├── a</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">├── b</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">└── c</span><br><span class="line">    ├── 1.txt</span><br><span class="line">    ├── 2.txt</span><br><span class="line">    └── 3.txt</span><br><span class="line"></span><br><span class="line">3 directories, 9 files</span><br></pre></td></tr></table></figure>
<ul>
<li><p>需求01: 将/kinmfer目录下面 a目录数据全部备份 b目录不要备份1.txt文件 c整个目录不要做备份</p>
<pre><code>--exclude=PATTERN</code></pre>
<ul>
<li><p>绝对路径方式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rsync -avz /kinmfer --exclude=/kinmfer/b/1.txt --exclude=/kinmfer/c/ rsync_backup@172.16.1.41::backup</span></span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">kinmfer/</span><br><span class="line">kinmfer/a/</span><br><span class="line">kinmfer/a/1.txt</span><br><span class="line">kinmfer/a/2.txt</span><br><span class="line">kinmfer/a/3.txt</span><br><span class="line">kinmfer/b/</span><br><span class="line">kinmfer/b/2.txt</span><br><span class="line">kinmfer/b/3.txt</span><br><span class="line"></span><br><span class="line">sent 387 bytes  received 135 bytes  116.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure></li>
<li><p>采用相对路径方式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rsync -avz /kinmfer --exclude=b/1.txt --exclude=c/ rsync_backup@172.16.1.41::backup</span></span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">kinmfer/</span><br><span class="line">kinmfer/a/</span><br><span class="line">kinmfer/a/1.txt</span><br><span class="line">kinmfer/a/2.txt</span><br><span class="line">kinmfer/a/3.txt</span><br><span class="line">kinmfer/b/</span><br><span class="line">kinmfer/b/2.txt</span><br><span class="line">kinmfer/b/3.txt</span><br><span class="line"></span><br><span class="line">sent 387 bytes  received 135 bytes  208.80 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>需求02: 将/oldboy目录下面 a目录数据全部备份 b目录不要备份1.txt文件 c整个目录1.txt 3.txt文件不要备份<br>–exclude-from=file  — 批量排除</p>
<ul>
<li><p>编辑好一个排除文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># cat /kinmfer/exclude.txt</span></span><br><span class="line">b/1.txt</span><br><span class="line">c/1.txt</span><br><span class="line">c/3.txt</span><br><span class="line">exclude.txt <span class="comment"># 将自身排除</span></span><br></pre></td></tr></table></figure></li>
<li><p>实现批量排除功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rsync -avz /kinmfer --exclude-from=/kinmfer/b/1.txt --exclude=/kinmfer/c/ rsync_backup@172.16.1.41::backup</span></span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">kinmfer/</span><br><span class="line">kinmfer/exclude.txt</span><br><span class="line">kinmfer/a/</span><br><span class="line">kinmfer/a/1.txt</span><br><span class="line">kinmfer/a/2.txt</span><br><span class="line">kinmfer/a/3.txt</span><br><span class="line">kinmfer/b/</span><br><span class="line">kinmfer/b/1.txt</span><br><span class="line">kinmfer/b/2.txt</span><br><span class="line">kinmfer/b/3.txt</span><br><span class="line"></span><br><span class="line">sent 536 bytes  received 177 bytes  83.88 bytes/sec</span><br><span class="line">total size is 36  speedup is 0.05</span><br></pre></td></tr></table></figure>
<h3 id="守护进程来创建备份目录-不需要手动输入密码"><a href="#守护进程来创建备份目录-不需要手动输入密码" class="headerlink" title="守护进程来创建备份目录(不需要手动输入密码)"></a>守护进程来创建备份目录(不需要手动输入密码)</h3></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]<span class="comment"># rsync -avz /etc/hosts  rsync_backup@172.16.1.41::backup/192.168.242.31/ --password-file=/etc/rsync.password</span></span><br><span class="line">sending incremental file list</span><br><span class="line">created directory 192.168.242.31</span><br><span class="line">hosts</span><br><span class="line"></span><br><span class="line">sent 227 bytes  received 80 bytes  614.00 bytes/sec</span><br><span class="line">total size is 371  speedup is 1.21</span><br></pre></td></tr></table></figure>
<p><strong>PS: 客户端无法在服务端创建多级目录</strong></p>
<h3 id="守护进程的访问控制配置"><a href="#守护进程的访问控制配置" class="headerlink" title="守护进程的访问控制配置"></a>守护进程的访问控制配置</h3><p>守护进程白名单和黑名单功能</p>
<h3 id="守护进程的列表功能配置"><a href="#守护进程的列表功能配置" class="headerlink" title="守护进程的列表功能配置"></a>守护进程的列表功能配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 /]<span class="comment"># rsync rsync_backup@172.16.1.41::</span></span><br><span class="line">backup         	<span class="string">&quot;backup dir by kinmfer&quot;</span></span><br><span class="line">dba            	<span class="string">&quot;backup dir by kinmfer&quot;</span></span><br><span class="line">dev            	<span class="string">&quot;backup dir by kinmfer&quot;</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:kinmfer@foxmail.com">Kinmfer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kinmfer.github.io/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB+%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/">https://kinmfer.github.io/2020/05/05/综合架构-文件共享+传输服务/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Kinmfer.github.io" target="_blank">Kinmfer's Blogs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/">数据同步</a><a class="post-meta__tags" href="/tags/NFS/">NFS</a><a class="post-meta__tags" href="/tags/Rsync/">Rsync</a><a class="post-meta__tags" href="/tags/FTP/">FTP</a><a class="post-meta__tags" href="/tags/Samba/">Samba</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/Kinmfer/BlogImages/raw/master/img/QQ截图20200509215804.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/05/05/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-Ansible-01-%E7%AE%80%E4%BB%8B/"><img class="prev-cover" src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/2d7bb9d477bdbeb14d417d84e5a818d9.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ansible01-简介</div></div></a></div><div class="next-post pull-right"><a href="/2020/05/05/%E5%B0%8F%E5%AE%9E%E9%AA%8C-02-%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"><img class="next-cover" src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/49b2d37bec5179f5d38f3ee6b5e83d1c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">小实验-02-实时同步</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/05/05/小实验-02-实时同步/" title="小实验-02-实时同步"><img class="cover" src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/49b2d37bec5179f5d38f3ee6b5e83d1c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-05</div><div class="title">小实验-02-实时同步</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC81MTkzMi8yODQxMw=="></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://gitee.com/Kinmfer/BlogImages/raw/master/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Kinmfer</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Kinmfer"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Kinmfer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:kinmfer@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#FTP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">FTP服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ftp%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.</span> <span class="toc-text">ftp协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ftp%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">ftp模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.</span> <span class="toc-text">控制连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.</span> <span class="toc-text">数据连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">主动模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">被动模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vsftpd%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">Vsftpd服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FTP%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85"><span class="toc-number">2.1.</span> <span class="toc-text">FTP服务的使用者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B1%EF%BC%9A%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7"><span class="toc-number">2.3.</span> <span class="toc-text">实例1：匿名用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B2-%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7"><span class="toc-number">2.4.</span> <span class="toc-text">实例2: 本地用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B3%EF%BC%9A%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7"><span class="toc-number">2.5.</span> <span class="toc-text">实例3：虚拟用户</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lftp%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">lftp命令详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95ftp"><span class="toc-number">3.1.</span> <span class="toc-text">登录ftp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lftp%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.</span> <span class="toc-text">lftp中文乱码问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BEftp%E7%AB%AF%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">查找ftp端文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">3.4.</span> <span class="toc-text">下载文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.</span> <span class="toc-text">上传文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A2%AB%E5%8A%A8-%E9%9D%9E%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.6.</span> <span class="toc-text">设置被动&#x2F;非被动模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">多任务处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">3.8.</span> <span class="toc-text">其他命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.</span> <span class="toc-text">Samba服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.1.</span> <span class="toc-text">SMB协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CIFS%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.</span> <span class="toc-text">CIFS协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CIFS%E5%8D%8F%E8%AE%AE%E7%89%B9%E7%82%B9"><span class="toc-number">4.3.</span> <span class="toc-text">CIFS协议特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-number">4.4.</span> <span class="toc-text">Samba服务简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E5%8A%9F%E8%83%BD"><span class="toc-number">4.5.</span> <span class="toc-text">Samba功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.6.</span> <span class="toc-text">Samba提供服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E7%9A%84%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.7.</span> <span class="toc-text">Samba的守护进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">4.8.</span> <span class="toc-text">Samba的软件包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%A7%88"><span class="toc-number">4.9.</span> <span class="toc-text">Samba服务概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">4.10.</span> <span class="toc-text">Samba相关工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">4.11.</span> <span class="toc-text">Samba相关配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E5%AE%89%E5%85%A8%E7%AD%89%E7%BA%A7"><span class="toc-number">4.12.</span> <span class="toc-text">Samba安全等级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E8%B4%A6%E6%88%B7%E5%8F%8A%E5%8F%A3%E4%BB%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.13.</span> <span class="toc-text">Samba账户及口令数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.14.</span> <span class="toc-text">默认配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90"><span class="toc-number">4.15.</span> <span class="toc-text">Samba服务权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"><span class="toc-number">4.16.</span> <span class="toc-text">Samba服务部署</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NFS%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.</span> <span class="toc-text">NFS服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NFS%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">NFS服务搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">6.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.2.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">6.3.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">6.3.1.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="toc-number">6.3.1.1.</span> <span class="toc-text">创建目录并授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">6.3.1.2.</span> <span class="toc-text">配置文件的参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">6.3.2.</span> <span class="toc-text">客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD"><span class="toc-number">6.3.2.1.</span> <span class="toc-text">挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD"><span class="toc-number">6.3.2.2.</span> <span class="toc-text">卸载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5"><span class="toc-number">6.3.2.3.</span> <span class="toc-text">检查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS%E6%8E%92%E9%94%99"><span class="toc-number">6.4.</span> <span class="toc-text">NFS排错</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF-1"><span class="toc-number">6.4.1.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-1"><span class="toc-number">6.4.2.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.4.3.</span> <span class="toc-text">示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Rsync"><span class="toc-number">7.</span> <span class="toc-text">Rsync</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Rsync%E7%89%B9%E6%80%A7"><span class="toc-number">7.1.</span> <span class="toc-text">Rsync特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rsync%E5%9C%A8%E4%BC%81%E4%B8%9A%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%9C%BA%E6%99%AF"><span class="toc-number">7.2.</span> <span class="toc-text">Rsync在企业的工作场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rsync%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">Rsync命令行常用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rsync%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">7.4.</span> <span class="toc-text">Rsync优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rsync%E9%83%A8%E7%BD%B2"><span class="toc-number">7.5.</span> <span class="toc-text">Rsync部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF-2"><span class="toc-number">7.5.1.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="toc-number">7.5.1.1.</span> <span class="toc-text">第一步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5"><span class="toc-number">7.5.1.2.</span> <span class="toc-text">第二步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5"><span class="toc-number">7.5.1.3.</span> <span class="toc-text">第三步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5"><span class="toc-number">7.5.1.4.</span> <span class="toc-text">第四步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5"><span class="toc-number">7.5.1.5.</span> <span class="toc-text">第五步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5"><span class="toc-number">7.5.1.6.</span> <span class="toc-text">第六步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E6%AD%A5"><span class="toc-number">7.5.1.7.</span> <span class="toc-text">第七步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-2"><span class="toc-number">7.5.2.</span> <span class="toc-text">客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-1"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">第一步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-1"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">第二步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8"><span class="toc-number">7.6.</span> <span class="toc-text">守护进程服务企业应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E5%A4%9A%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">7.6.1.</span> <span class="toc-text">守护进程多模块功能配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8E%92%E9%99%A4%E5%8A%9F%E8%83%BD%E5%AE%9E%E8%B7%B5"><span class="toc-number">7.6.2.</span> <span class="toc-text">守护进程的排除功能实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%9D%A5%E5%88%9B%E5%BB%BA%E5%A4%87%E4%BB%BD%E7%9B%AE%E5%BD%95-%E4%B8%8D%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81"><span class="toc-number">7.6.3.</span> <span class="toc-text">守护进程来创建备份目录(不需要手动输入密码)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">7.6.4.</span> <span class="toc-text">守护进程的访问控制配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">7.6.5.</span> <span class="toc-text">守护进程的列表功能配置</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/GOLANG-06-%E5%88%87%E7%89%87/" title="GOLANG-06-切片"><img src="https://gitee.com/kinmfer/BlogImages/raw/master/img/GO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOLANG-06-切片"/></a><div class="content"><a class="title" href="/2021/01/25/GOLANG-06-%E5%88%87%E7%89%87/" title="GOLANG-06-切片">GOLANG-06-切片</a><time datetime="2021-01-25T05:06:45.000Z" title="发表于 2021-01-25 13:06:45">2021-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/GOLANG-05-%E6%95%B0%E7%BB%84/" title="GOLANG-05-数组"><img src="https://gitee.com/kinmfer/BlogImages/raw/master/img/GO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOLANG-05-数组"/></a><div class="content"><a class="title" href="/2021/01/25/GOLANG-05-%E6%95%B0%E7%BB%84/" title="GOLANG-05-数组">GOLANG-05-数组</a><time datetime="2021-01-25T05:06:32.000Z" title="发表于 2021-01-25 13:06:32">2021-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/GOLANG-04-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="GOLANG-04-流程控制"><img src="https://gitee.com/kinmfer/BlogImages/raw/master/img/GO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOLANG-04-流程控制"/></a><div class="content"><a class="title" href="/2021/01/25/GOLANG-04-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="GOLANG-04-流程控制">GOLANG-04-流程控制</a><time datetime="2021-01-25T05:06:17.000Z" title="发表于 2021-01-25 13:06:17">2021-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/GOLANG-03-%E8%BF%90%E7%AE%97%E7%AC%A6/" title="GOLANG-03-运算符"><img src="https://gitee.com/kinmfer/BlogImages/raw/master/img/GO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOLANG-03-运算符"/></a><div class="content"><a class="title" href="/2021/01/25/GOLANG-03-%E8%BF%90%E7%AE%97%E7%AC%A6/" title="GOLANG-03-运算符">GOLANG-03-运算符</a><time datetime="2021-01-25T05:05:58.000Z" title="发表于 2021-01-25 13:05:58">2021-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/GOLANG-02-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="GOLANG-02-数据类型"><img src="https://gitee.com/kinmfer/BlogImages/raw/master/img/GO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOLANG-02-数据类型"/></a><div class="content"><a class="title" href="/2021/01/25/GOLANG-02-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="GOLANG-02-数据类型">GOLANG-02-数据类型</a><time datetime="2021-01-25T05:05:43.000Z" title="发表于 2021-01-25 13:05:43">2021-01-25</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://gitee.com/Kinmfer/BlogImages/raw/master/img/QQ截图20200509215804.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Kinmfer</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://kinmfer.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'vSKb5nQqvUv44yjbvGjUmk3E-gzGzoHsz',
      appKey: '4TRbJGECRE8pcN777qgBXsKO',
      placeholder: '记得留下你的昵称和邮箱,可以快速收到回复哦~',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_����":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_͵Ц":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_�ټ�":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_��Į":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_��ŭ":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_�ɰ�":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_��Ѫ":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_��":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_Ż��":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_��Ц":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_���":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_ί��":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_΢Ц":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_˼��":"90cf159733e558137ed20aa04d09964436f618a1.png"},
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Valine' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="//code.tidio.co/mzqu2o1lbhle9bvhab8bexgtiyxgkheb.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script></div></body></html>